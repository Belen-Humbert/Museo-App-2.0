<div class="flex min-h-full flex-col justify-center px-6 py-3 lg:px-8">
  <div class="sm:mx-auto sm:w-full sm:max-w-sm">
    <h2 class="mt-4 text-center text-4xl font-bold leading-9 tracking-tight text-gray-900 dark:text-gray-300">Modificar
      pieza:</h2>
    <h6 class="mt-1 text-center text-2xl font-bold leading-9 tracking-tight text-gray-900 dark:text-gray-300">
      {{piezas.NombrePieza}}</h6>
  </div>

  <div class="mt-10 sm:mx-auto sm:w-full sm:max-w-sm">
    <form class="space-y-6" action="/actualizarPieza" method="POST">
      <div>
        <div class="mt-2">
          <input id="numero" name="numero" type="hidden" required readonly value="{{piezas.NumeroRegistro}}"
            class="block w-full rounded-md border-0 py-1.5 text-gray-200
            bg-zinc-800 shadow-sm ring-1 ring-inset ring-gray-300 value:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6" />
        </div>
      </div>

      <div class="mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6">
        <div class="sm:col-span-3">
          <label for="nombre" class="block text-sm font-medium leading-6 text-gray-900 dark:text-gray-300">Nombre de la
            pieza</label>
          <div class="mt-2">
            <input id="nombre" name="nombre" type="text" required value="{{piezas.NombrePieza}}" class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 value:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 p-2
              dark:text-gray-300 dark:bg-zinc-800" />
          </div>
        </div>
        <div class="sm:col-span-3">
          <label for="medida" class="block text-sm font-medium leading-6 text-gray-900 dark:text-gray-300">Medida de la
            pieza</label>
          <div class="mt-2">
            <input id="medida" name="medida" type="text" required value="{{piezas.MedidaPieza}}"
              class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 value:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 p-2 dark:text-gray-300 dark:bg-zinc-800" />
          </div>
        </div>
        <div class="sm:col-span-3">
          <label for="material"
            class="block text-sm font-medium leading-6 text-gray-900 dark:text-gray-300">Material</label>
          <div class="mt-2">
            <input id="material" name="material" type="text" required value="{{piezas.MaterialObjeto}}"
              class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 value:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 p-2 dark:text-gray-300 dark:bg-zinc-800" />
          </div>
        </div>
        <div class="sm:col-span-4">
          <label for="fechaAd" class="block text-sm font-medium leading-6 text-gray-900 dark:text-gray-300">Fecha de
            adquisicion de la pieza</label>
          <div class="mt-2">
            <input id="fechaAd" name="fechaAd" type="date" required value="{{piezas.FechaAdquisicion}}"
              class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 value:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 p-2 dark:text-gray-300 dark:bg-zinc-800" />
          </div>
        </div>
        <div class="sm:col-span-3">
          <label for="formaAd" class="block text-sm font-medium leading-6 text-gray-900 dark:text-gray-300">Forma
            adquirida de la pieza</label>
          <div class="mt-2">
            <input id="formaAd" name="formaAd" type="text" required value="{{piezas.FormaAdquirida}}"
              class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 value:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 p-2 dark:text-gray-300 dark:bg-zinc-800" />
          </div>
        </div>
        <div class="sm:col-span-3">
          <label for="Año" class="block text-sm font-medium leading-6 text-gray-900 dark:text-gray-300">Año de la
            pieza</label>
          <div class="mt-2">
          </div>
          <input id="Año" name="Año" type="number" required value="{{piezas.AñoPieza}}"
            class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 value:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 p-2 dark:text-gray-300 dark:bg-zinc-800" />
        </div>
        <div class="sm:col-span-3">
          <label for="estado" class="block text-sm font-medium leading-6 text-gray-900 dark:text-gray-300">Estado de la
            pieza</label>
          <div class="mt-2">
            <select id="estado" name="estado" required
              class="block w-full rounded-md border-0 py-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 value:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 p-2 dark:text-gray-300 dark:bg-zinc-800">
              <option value={{piezas.EstadoPieza}} disabled>Actual: {{piezas.EstadoPieza}}</option>
              <option value="Sana">Sana</option>
              <option value="Rota">Rota</option>
              <option value="En Reparación">En reparación</option>
            </select>
          </div>
        </div>
        <div class="sm:col-span-3">
          <label for="cantidad" class="block text-sm font-medium leading-6 text-gray-900 dark:text-gray-300">Cantidad de
            piezas</label>
          <div class="mt-2">
            <input id="cantidad" name="cantidad" type="number" required value="{{piezas.Cantidad}}"
              class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 value:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 p-2 dark:text-gray-300 dark:bg-zinc-800" />
          </div>
        </div>
        <div class="sm:col-span-3">
          <label for="obser"
            class="block text-sm font-medium leading-6 text-gray-900 dark:text-gray-300">Observacion</label>
          <div class="mt-2">
            <input id="obser" name="obser" type="text" required value="{{piezas.Observacion}}"
              class="rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 value:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 w-96 p-2 dark:text-gray-300 dark:bg-zinc-800" />
          </div>
        </div>

      </div>
      <div class="flex space-x-4">
        <a href="/listarPieza"
          class="flex w-full justify-center rounded-md bg-transparent px-3 py-1.5 text-sm font-semibold leading-6 text-red-600 border border-red-600 hover:bg-red-600 hover:text-white shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-600">Cancelar</a>

        <button type="submit"
          class="flex w-full justify-center rounded-md bg-indigo-600 px-3 py-1.5 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">Guardar
          Cambios</button>
      </div>
    </form>
  </div>
</div>

{{!-- Modal de error --}}
<div id="errorModal" class="fixed top-5 left-1/2 transform -translate-x-1/2 z-50" style="display: none;">
  <div
    class="border-[1px] border-blue-200 bg-blue-100 dark:bg-blue-800 dark:border-blue-500 rounded-lg text-black dark:text-gray-100 shadow-lg p-6 transition-colors duration-200 px-4 py-2 flex items-center space-x-4">
    <p id="errorMessage"></p>
    <button class="close-button">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor">
        <path
          d="M11.9997 10.5865L16.9495 5.63672L18.3637 7.05093L13.4139 12.0007L18.3637 16.9504L16.9495 18.3646L11.9997 13.4149L7.04996 18.3646L5.63574 16.9504L10.5855 12.0007L5.63574 7.05093L7.04996 5.63672L11.9997 10.5865Z">
        </path>
      </svg>
    </button>
  </div>
</div>

<script>
  document.querySelector('form').addEventListener('submit', function (event) {
    const numero = document.getElementById('numero').value;
    const nombre = document.getElementById('nombre').value;
    const medida = document.getElementById('medida').value;
    const material = document.getElementById('material').value;
    const fechaAd = document.getElementById('fechaAd').value;
    const formaAd = document.getElementById('formaAd').value;
    const año = document.getElementById('Año').value;
    const estado = document.getElementById('estado').value;
    const cantidad = document.getElementById('cantidad').value;
    const obser = document.getElementById('obser').value;

    let valid = true;
    let messages = [];

    // Validaciones de los inputs
    if (!/^\d+$/.test(numero)) {
      valid = false;
      messages.push("El número de registro debe ser un número entero positivo.");
    }
    if (!/^[a-zA-Z0-9\s]+$/.test(nombre)) {
      valid = false;
      messages.push("El nombre de la pieza solo puede contener caracteres alfanuméricos.");
    }
    if (!/^[a-zA-Z0-9\s]+$/.test(medida)) {
      valid = false;
      messages.push("La medida de la pieza solo puede contener caracteres alfanuméricos.");
    }
    if (!/^[a-zA-ZáéíóúüñÁÉÍÓÚÜÑ0-9\s.,;]+$/.test(material)) {
      valid = false;
      messages.push("El material de la pieza solo puede contener caracteres alfanuméricos.");
    }
    if (fechaAd === "") {
      valid = false;
      messages.push("La fecha de adquisición es requerida.");
    }
    if (!/^[a-zA-ZáéíóúüñÁÉÍÓÚÜÑ0-9\s.,;]+$/.test(formaAd)) {
      valid = false;
      messages.push("La forma de adquisición de la pieza solo puede contener caracteres alfanuméricos.");
    }
    if (!/^\d+$/.test(año) || año < 0) {
      valid = false;
      messages.push("El año de la pieza debe ser un número entero positivo.");
    }
    if (estado === "") {
      valid = false;
      messages.push("El estado de la pieza es requerido.");
    }
    if (!/^\d+$/.test(cantidad) || cantidad <= 0) {
      valid = false;
      messages.push("La cantidad de piezas debe ser un número entero positivo.");
    }
    if (!/^[a-zA-ZáéíóúüñÁÉÍÓÚÜÑ0-9\s.,;]+$/.test(obser)) {
      valid = false;
      messages.push("La observación solo puede contener caracteres alfanuméricos.");
    }

    // Enviar error
    if (!valid) {
      event.preventDefault();
      const errorModal = document.getElementById('errorModal');
      const errorMessage = document.getElementById('errorMessage');
      errorMessage.textContent = messages.join("\n");
      errorModal.style.display = 'flex';
    } else {
      this.submit();
    }
  });

  // Para cerrar el modal de error
  const closeButton = document.querySelector('.close-button');
  closeButton.addEventListener('click', function () {
    const errorModal = document.getElementById('errorModal');
    errorModal.style.display = 'none';
  });
</script>