<div class="flex min-h-full flex-col justify-center px-6 py-3 lg:px-8">
  <div class="sm:mx-auto sm:w-full sm:max-w-sm">
    <h2 class="mt-4 text-center text-4xl font-bold leading-9 tracking-tight text-gray-900 dark:text-gray-300">Modificar
      Préstamo:</h2>
    <h6 class="mt-1 text-center text-2xl font-bold leading-9 tracking-tight text-gray-900 dark:text-gray-300">
      {{prestamo.numeroPrestamo}}</h6>
  </div>

  <div class="mt-10 sm:mx-auto sm:w-full sm:max-w-sm">
    <form class="space-y-6" action="/actualizarPrestamo" method="POST">

      <div>
        <label for="numeroPrestamo" class="block text-sm font-medium leading-6 text-gray-900 dark:text-gray-300">Numero
          de Prestamo</label>
        <div class="mt-2">
          <input id="numeroPrestamo" name="numeroPrestamo" type="number" required readonly
            value="{{prestamo.numeroPrestamo}}" class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 value:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 p-2
              dark:text-gray-300 dark:bg-zinc-800" />
        </div>
      </div>

      <div>
        <label for="numeroPiezas" class="block text-sm font-medium text-gray-900 dark:text-gray-100">Número de
          piezas</label>
        <input type="text" name="numeroPiezas" id="numeroPiezas" required
          class="mt-2 block w-full rounded-md border-0 py-1.5 px-2 text-zinc-900 dark:text-zinc-300 bg-white dark:bg-zinc-800 shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-zinc-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 dark:focus:ring-indigo-500 sm:text-sm sm:leading-6">
          <Select name="piezaId" id="piezaId" required class="mt-2 block w-full rounded-md border-0 py-2 px-2 text-zinc-900 dark:text-zinc-300 bg-white dark:bg-zinc-800 shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-zinc-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 dark:focus:ring-indigo-500 sm:text-sm sm:leading-6">
            {{#each piezas}}
              <option value="{{this.NumeroRegistro}}">{{this.NumeroRegistro}} - {{this.NombrePieza}}</option>
            {{/each}}
          </Select>
      </div>

      <div>
        <label for="eventoPrestamo" class="block text-sm font-medium leading-6 text-gray-900 dark:text-gray-300">Tipo de
          Evento</label>
        <div class="mt-2">
          <input id="eventoPrestamo" name="eventoPrestamo" type="text" required value="{{prestamo.eventoPrestamo}}"
            class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 value:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 p-2
              dark:text-gray-300 dark:bg-zinc-800" />
        </div>
      </div>

      <div>
        <label for="fechaPrestamo" class="block text-sm font-medium leading-6 text-gray-900 dark:text-gray-300">Fecha de
          Prestamo</label>
        <div class="mt-2">
          <input id="fechaPrestamo" name="fechaPrestamo" type="date" required value="{{prestamo.fechaPrestamo}}" class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 value:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 p-2
              dark:text-gray-300 dark:bg-zinc-800" />
        </div>
      </div>

      <div>
        <label for="fechaDevolucion" class="block text-sm font-medium leading-6 text-gray-900 dark:text-gray-300">Fecha
          de Devolucion</label>
        <div class="mt-2">
          <input id="fechaDevolucion" name="fechaDevolucion" type="date" required value="{{prestamo.fechaDevolucion}}"
            class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 value:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 p-2
              dark:text-gray-300 dark:bg-zinc-800" />
        </div>
      </div>

      <div>
        <label for="cantidad"
          class="block text-sm font-medium leading-6 text-gray-900 dark:text-gray-300">Cantidad</label>
        <div class="mt-2">
          <input id="cantidad" name="cantidad" type="number" required value="{{prestamo.cantidad}}" class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 value:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 p-2
              dark:text-gray-300 dark:bg-zinc-800" />
        </div>
      </div>

      <div>
        <label for="observacionPrestamo"
          class="block text-sm font-medium leading-6 text-gray-900 dark:text-gray-300">Observacion</label>
        <div class="mt-2">
          <input id="observacionPrestamo" name="observacionPrestamo" type="text" required
            value="{{prestamo.observacionPrestamo}}" class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 value:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 p-2
              dark:text-gray-300 dark:bg-zinc-800" />
        </div>
      </div>
      <div class="flex space-x-4">
        <a href="/listarPrestamo"
          class="flex w-full justify-center rounded-md bg-transparent px-3 py-1.5 text-sm font-semibold leading-6 text-red-600 border border-red-600 hover:bg-red-600 hover:text-white shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-600">Cancelar</a>

        <button type="submit"
          class="flex w-full justify-center rounded-md bg-indigo-600 px-3 py-1.5 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">Guardar
          Cambios</button>
      </div>
    </form>
  </div>
</div>

{{!-- Modal de error --}}
<div id="errorModal" class="fixed top-5 left-1/2 transform -translate-x-1/2 z-50" style="display: none;">
  <div
    class="border-[1px] border-blue-200 bg-blue-100 dark:bg-blue-800 dark:border-blue-500 rounded-lg text-black dark:text-gray-100 shadow-lg p-6 transition-colors duration-200 px-4 py-2 flex items-center space-x-4">
    <p id="errorMessage"></p>
    <button class="close-button">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor">
        <path
          d="M11.9997 10.5865L16.9495 5.63672L18.3637 7.05093L13.4139 12.0007L18.3637 16.9504L16.9495 18.3646L11.9997 13.4149L7.04996 18.3646L5.63574 16.9504L10.5855 12.0007L5.63574 7.05093L7.04996 5.63672L11.9997 10.5865Z">
        </path>
      </svg>
    </button>
  </div>
</div>

<script>
  document.querySelector('form').addEventListener('submit', function (event) {
    const numeroPrestamo = document.getElementById('numeroPrestamo').value;
    const numeroPiezas = document.getElementById('numeroPiezas').value;
    const eventoPrestamo = document.getElementById('eventoPrestamo').value;
    const fechaPrestamo = document.getElementById('fechaPrestamo').value;
    const fechaDevolucion = document.getElementById('fechaDevolucion').value;
    const cantidad = document.getElementById('cantidad').value;
    const observacionPrestamo = document.getElementById('observacionPrestamo').value;

    let valid = true;
    let messages = [];

    // Validaciones de los inputs
    if (!/^\d+$/.test(numeroPrestamo)) {
      valid = false;
      messages.push("El número de préstamo debe ser un número entero positivo.");
    }
    if (!/^[a-zA-Z0-9\s]+$/.test(numeroPiezas)) {
      valid = false;
      messages.push("El número de piezas solo puede contener caracteres alfanuméricos.");
    }
    if (!/^[a-zA-ZáéíóúüñÁÉÍÓÚÜÑ0-9\s.,;]+$/.test(eventoPrestamo)) {
      valid = false;
      messages.push("El tipo de evento solo puede contener caracteres alfanuméricos.");
    }
    if (fechaPrestamo === "") {
      valid = false;
      messages.push("La fecha de préstamo es requerida.");
    }
    if (fechaDevolucion === "") {
      valid = false;
      messages.push("La fecha de devolución es requerida.");
    }
    if (!/^\d+$/.test(cantidad) || cantidad <= 0) {
      valid = false;
      messages.push("La cantidad debe ser un número entero positivo.");
    }

    // Enviar error
    if (!valid) {
      event.preventDefault();
      const errorModal = document.getElementById('errorModal');
      const errorMessage = document.getElementById('errorMessage');
      errorMessage.textContent = messages.join("\n");
      errorModal.style.display = 'flex';
    } else {
      this.submit();
    }
  });

  // Para cerrar el modal de error
  const closeButton = document.querySelector('.close-button');
  closeButton.addEventListener('click', function () {
    const errorModal = document.getElementById('errorModal');
    errorModal.style.display = 'none';
  });
</script>