<div class="flex min-h-full flex-col justify-center px-6 py-3 lg:px-8">
  <div class="sm:mx-auto sm:w-full sm:max-w-lg">
    <h1 class="text-4xl font-bold text-center text-gray-900 dark:text-white">Registrar Préstamo</h1>
  </div>

  <div class="mt-4 sm:mx-auto sm:w-full sm:max-w-lg">
    <form class="space-y-6" action="/registrarprestamo" method="POST">
      <div>
        <label for="numeroPrestamo" class="block text-sm font-medium text-gray-900 dark:text-gray-100">Número de
          préstamo</label>
        <input type="number" name="numeroPrestamo" id="numeroPrestamo" required
          class="mt-2 block w-full rounded-md border-0 py-1.5 px-2 text-zinc-900 dark:text-zinc-300 bg-white dark:bg-zinc-800 shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-zinc-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 dark:focus:ring-indigo-500 sm:text-sm sm:leading-6">
      </div>

      <div>
        <label for="numeroPiezas" class="block text-sm font-medium text-gray-900 dark:text-gray-100">Número de
          piezas</label>
        <input type="text" name="numeroPiezas" id="numeroPiezas" required
          class="mt-2 block w-full rounded-md border-0 py-1.5 px-2 text-zinc-900 dark:text-zinc-300 bg-white dark:bg-zinc-800 shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-zinc-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 dark:focus:ring-indigo-500 sm:text-sm sm:leading-6">
      </div>

      <div>
        <label for="eventoPrestamo"
          class="block text-sm font-medium text-gray-900 dark:text-gray-100">Evento</label>
        <input type="text" name="eventoPrestamo" id="eventoPrestamo" required
          class="mt-2 block w-full rounded-md border-0 py-1.5 px-2 text-zinc-900 dark:text-zinc-300 bg-white dark:bg-zinc-800 shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-zinc-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 dark:focus:ring-indigo-500 sm:text-sm sm:leading-6">
      </div>

      <div>
        <label for="fechaPrestamo" class="block text-sm font-medium text-gray-900 dark:text-gray-100">Fecha de
          préstamo</label>
        <input type="date" name="fechaPrestamo" id="fechaPrestamo" required
          class="mt-2 block w-full rounded-md border-0 py-1.5 px-2 text-zinc-900 dark:text-zinc-300 bg-white dark:bg-zinc-800 shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-zinc-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 dark:focus:ring-indigo-500 sm:text-sm sm:leading-6">
      </div>

      <div>
        <label for="fechaDevolucion" class="block text-sm font-medium text-gray-900 dark:text-gray-100">Fecha de
          devolución</label>
        <input type="date" name="fechaDevolucion" id="fechaDevolucion" required
          class="mt-2 block w-full rounded-md border-0 py-1.5 px-2 text-zinc-900 dark:text-zinc-300 bg-white dark:bg-zinc-800 shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-zinc-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 dark:focus:ring-indigo-500 sm:text-sm sm:leading-6">
      </div>

      <div>
        <label for="cantidad"
          class="block text-sm font-medium text-gray-900 dark:text-gray-100">Cantidad</label>
        <input type="number" name="cantidad" id="cantidad" required
          class="mt-2 block w-full rounded-md border-0 py-1.5 px-2 text-zinc-900 dark:text-zinc-300 bg-white dark:bg-zinc-800 shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-zinc-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 dark:focus:ring-indigo-500 sm:text-sm sm:leading-6">
      </div>

      <div>
        <label for="observacionPrestamo"
          class="block text-sm font-medium text-gray-900 dark:text-gray-100">Observación</label>
        <input type="text" name="observacionPrestamo" id="observacionPrestamo" required
          class="mt-2 block w-full rounded-md border-0 py-1.5 px-2 text-zinc-900 dark:text-zinc-300 bg-white dark:bg-zinc-800 shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-zinc-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 dark:focus:ring-indigo-500 sm:text-sm sm:leading-6">
      </div>

      <!-- Campo oculto para BajaLogica -->
      <input type="hidden" name="BajaLogica" value="false">

      <div class="flex space-x-4">
        <a href="/listarPrestamo"
          class="flex w-full justify-center rounded-md bg-transparent px-3 py-1.5 text-sm font-semibold leading-6 text-red-600 border border-red-600 hover:bg-red-600 hover:text-white shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-600">Cancelar</a>

        <button type="submit"
          class="flex w-full justify-center rounded-md bg-indigo-600 px-3 py-1.5 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">Enviar</button>
      </div>
    </form>
  </div>
</div>

{{!-- Modal de error --}}
<div id="errorModal" class="fixed top-5 left-1/2 transform -translate-x-1/2 z-50" style="display: none;">
  <div class="border-[1px] border-blue-200 bg-blue-100 dark:bg-blue-800 dark:border-blue-500 rounded-lg text-black dark:text-gray-100 shadow-lg p-6 transition-colors duration-200 px-4 py-2 flex items-center space-x-4">
    <ul id="errorList"></ul>
    <button class="close-button">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor">
        <path d="M11.9997 10.5865L16.9495 5.63672L18.3637 7.05093L13.4139 12.0007L18.3637 16.9504L16.9495 18.3646L11.9997 13.4149L7.04996 18.3646L5.63574 16.9504L10.5855 12.0007L5.63574 7.05093L7.04996 5.63672L11.9997 10.5865Z"></path>
      </svg>
    </button>
  </div>
</div>

<script>
  document.querySelector('form').addEventListener('submit', function (event) {
    const numeroPrestamo = document.getElementById('numeroPrestamo').value;
    const numeroPiezas = document.getElementById('numeroPiezas').value;
    const eventoPrestamo = document.getElementById('eventoPrestamo').value;
    const fechaPrestamo = document.getElementById('fechaPrestamo').value;
    const fechaDevolucion = document.getElementById('fechaDevolucion').value;
    const cantidad = document.getElementById('cantidad').value;
    const observacionPrestamo = document.getElementById('observacionPrestamo').value;

    let valid = true;
    let messages = [];

    // Validaciones de los inputs
    if (!/^\d+$/.test(numeroPrestamo)) {
      valid = false;
      messages.push("* El número de préstamo debe ser un número entero positivo.");
    }
    if (!/^\d+$/.test(numeroPiezas)) {
      valid = false;
      messages.push("* El número de piezas debe ser un número entero positivo.");
    }
    if (!/^[a-zA-ZáéíóúüñÁÉÍÓÚÜÑ0-9\s.,;]+$/.test(eventoPrestamo)) {
      valid = false;
      messages.push("* El evento solo puede contener caracteres alfanuméricos.");
    }
    if (fechaPrestamo === "") {
      valid = false;
      messages.push("* La fecha de préstamo es requerida.");
    }
    if (fechaDevolucion === "") {
      valid = false;
      messages.push("* La fecha de devolución es requerida.");
    }
    if (!/^\d+$/.test(cantidad) || cantidad <= 0) {
      valid = false;
      messages.push("* La cantidad debe ser un número entero positivo.");
    }

    // Enviar error
    if (!valid) {
      event.preventDefault();
      const errorModal = document.getElementById('errorModal');
      const errorList = document.getElementById('errorList');
      errorList.innerHTML = ''; // Limpiar la lista de errores

      messages.forEach(message => {
        const li = document.createElement('li');
        li.textContent = message;
        errorList.appendChild(li);
      });

      errorModal.style.display = 'flex';

    } else {
      this.submit();
    }
  });

  // Para cerrar el modal de error
  const closeButton = document.querySelector('.close-button');
  closeButton.addEventListener('click', function () {
    const errorModal = document.getElementById('errorModal');
    errorModal.style.display = 'none';
  });
</script>
